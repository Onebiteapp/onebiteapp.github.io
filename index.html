<!DOCTYPE html>
<html>
<head>
<title>One Bite</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  background:black;
  color:gold;
  font-family:sans-serif;
  text-align:center;
}

.menu{
  border:1px solid gold;
  padding:10px;
  margin:10px;
  border-radius:10px;
}

button{
  background:gold;
  color:black;
  padding:8px 15px;
  border:none;
  margin-top:5px;
  border-radius:5px;
}

input, select{
  padding:8px;
  margin:5px;
  width:80%;
}
</style>
</head>

<body>

<h1>üçî One Bite</h1>
<h3>2km Free Delivery | After 2km ‚Çπ20</h3>

<div class="menu">
  <h3>Veg Burger - ‚Çπ69</h3>
  <button onclick="addToCart(69,'Veg Burger')">Add</button>
</div>

<div class="menu">
  <h3>Chicken Burger - ‚Çπ79</h3>
  <button onclick="addToCart(79,'Chicken Burger')">Add</button>
</div>

<hr>

<h3>Food Total: ‚Çπ<span id="total">0</span></h3>
<h3>Delivery: ‚Çπ<span id="delivery">0</span></h3>
<h2>Final Total: ‚Çπ<span id="final">0</span></h2>

<hr>

<input type="text" id="name" placeholder="Your Name"><br>
<input type="text" id="phone" placeholder="Phone Number"><br>
<input type="text" id="address" placeholder="Delivery Address"><br>

<select id="payment">
  <option value="COD">Cash On Delivery</option>
  <option value="POD">Pay On Delivery (Online)</option>
</select>

<br><br>
<button onclick="placeOrder()">Place Order</button>

<br><br>
<div id="payNowSection" style="display:none;">
  <button onclick="payOnline()">Pay Now</button>
</div>

<script>

let total = 0;
let delivery = 0;
let cart = [];
let finalAmount = 0;

const kitchenLat = 22.8665;
const kitchenLng = 88.3672;
const upiID = "7003355253@ibl";

function addToCart(price,item){
  total += price;
  cart.push(item + " - ‚Çπ" + price);
  document.getElementById("total").innerText = total;
}

function calculateDistance(userLat,userLng){
  const R = 6371;
  const dLat = (userLat - kitchenLat) * Math.PI/180;
  const dLng = (userLng - kitchenLng) * Math.PI/180;
  const a =
    Math.sin(dLat/2)*Math.sin(dLat/2) +
    Math.cos(kitchenLat*Math.PI/180) *
    Math.cos(userLat*Math.PI/180) *
    Math.sin(dLng/2)*Math.sin(dLng/2);
  const c = 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
  return R*c;
}

function placeOrder(){

  if(cart.length===0){
    alert("Add items first!");
    return;
  }

  navigator.geolocation.getCurrentPosition(function(position){

    let userLat = position.coords.latitude;
    let userLng = position.coords.longitude;

    let distance = calculateDistance(userLat,userLng);

    delivery = distance>2 ? 20 : 0;
    finalAmount = total + delivery;

    document.getElementById("delivery").innerText = delivery;
    document.getElementById("final").innerText = finalAmount;

    let name = document.getElementById("name").value;
    let phone = document.getElementById("phone").value;
    let address = document.getElementById("address").value;
    let payment = document.getElementById("payment").value;

    let itemsList = cart.join("\n");

    let message = `New Order - One Bite

Name: ${name}
Phone: ${phone}
Address: ${address}

Items:
${itemsList}

Distance: ${distance.toFixed(2)} km
Delivery: ‚Çπ${delivery}
Total: ‚Çπ${finalAmount}
Payment: ${payment}`;

    let whatsappURL = `https://wa.me/917003355253?text=${encodeURIComponent(message)}`;
    window.open(whatsappURL,"_blank");

    if(payment === "POD"){
      document.getElementById("payNowSection").style.display = "block";
    } else {
      document.getElementById("payNowSection").style.display = "none";
    }

  });
}

function payOnline(){
  let upiLink = `upi://pay?pa=${upiID}&pn=OneBite&am=${finalAmount}&cu=INR`;
  window.location.href = upiLink;
}

</script>

</body>
</html>
