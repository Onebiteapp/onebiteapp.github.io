<!DOCTYPE html>
<html>
<head>
<title>One Bite Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  background:#000;
  color:#FFD700;
  font-family:sans-serif;
  padding:10px;
}

.order{
  background:#111;
  margin:12px 0;
  padding:12px;
  border-radius:10px;
  border:1px solid #FFD700;
}

select{
  padding:5px;
  margin-top:8px;
}

.dashboard{
  background:#111;
  padding:10px;
  margin-bottom:15px;
  border-radius:10px;
  border:1px solid #FFD700;
}
</style>
</head>
<body>

<h2>One Bite Premium Admin</h2>

<div class="dashboard">
  <h3>Today's Sales</h3>
  <div>Total Orders: <span id="orderCount">0</span></div>
  <div>Total Revenue: ₹<span id="totalRevenue">0</span></div>
</div>

<div id="orders"></div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyB63wz4Z8maGyYk7UdvZk2IvxwGXYePisA",
  authDomain: "onebiteapp-b19c3.firebaseapp.com",
  projectId: "onebiteapp-b19c3",
  storageBucket: "onebiteapp-b19c3.firebasestorage.app",
  messagingSenderId: "925416277184",
  appId: "1:925416277184:web:0af73016a42be902ea5925",
  databaseURL: "https://onebiteapp-b19c3-default-rtdb.asia-southeast1.firebasedatabase.app"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const ordersRef = ref(db, "orders");

onValue(ordersRef, (snapshot) => {
  const data = snapshot.val();
  let html = "";
  let totalRevenue = 0;
  let orderCount = 0;

  if(data){
    for(let id in data){
      let o = data[id];
      orderCount++;
      totalRevenue += parseInt(o.total || 0);

      html += `
        <div class="order">
          <b>Name:</b> ${o.name}<br>
          <b>Phone:</b> ${o.phone}<br>
          <b>Address:</b> ${o.address}<br>
          <b>Total:</b> ₹${o.total}<br>
          <b>Payment:</b> ${o.payment}<br>
          <b>Status:</b> ${o.status || "Pending"}<br>

          <select onchange="changeStatus('${id}', this.value)">
            <option value="Pending">Pending</option>
            <option value="Preparing">Preparing</option>
            <option value="Out for Delivery">Out for Delivery</option>
            <option value="Delivered">Delivered</option>
          </select>
        </div>
      `;
    }
  }

  document.getElementById("orders").innerHTML = html;
  document.getElementById("orderCount").innerText = orderCount;
  document.getElementById("totalRevenue").innerText = totalRevenue;
});

window.changeStatus = function(orderId, newStatus){
  const orderRef = ref(db, "orders/" + orderId);
  update(orderRef, { status: newStatus });
};

</script>

</body>
</html>
